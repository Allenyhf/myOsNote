# 操作系统之内存

<!--Note-->
#### 应试
- 页式管理与段式管理区别
	- 段式PPT例题
- 计算机系统角度（综合TLB/页表/cache知识）
	- 南大计算机系统（二）第六周第4节例题
<!--/Note-->

## 内存管理

### 连续区内存分配

#### 多重分区连续区内存分配

##### worst fit

##### first fit

##### best fit

### 页式内存管理

#### 页表

##### 层次页表

###### 二级页表

###### 三级页表

##### 哈希页表

逻辑地址->hash func->物理地址

##### 反向页表

Pid+逻辑页号

#### 有页表、TLB、PTBR、PTLR

<!--Note-->
####### 页表
- 逻辑地址映射到物理地址
####### TLB/快表
- 缓存最近（最热）的页表项
- 局部性原理
- 并行搜索
####### PTBR
- 页表基址寄存器
####### PTLR
- 页表长度寄存器
<!--/Note-->

#### 内存保护

##### 有效位

### 段式内存管理

<!--Note-->
###### 解决页式可能将不同访问权限数据混合在一起的问题
###### 按照访问权限管理：
- 代码段
- 只读数据段
- 可读可写数据段
- ...
<!--/Note-->

#### 有段表、STBR、STLR

#### 内存保护

##### 有效位

##### 特权位（2bit）

#### 缺点

##### 空间利用率低下，大量碎片

### 段页式内存管理

<!--Note-->
###### 综合段式与页式各自优点
- 一方面，提高内存空间利用率
- 另一方面，方便访问权限管理
###### 访问内存流程
- a.根据段地址查询段表，获得页地址
- b.根据页地址查询页表，获得PPN
- c.PPN+PPO(VPO)得到内存物理地址
<!--/Note-->

## 内存基本概念

### 地址

#### 物理地址

访问内存单元所用地址，亦即地址总线上的地址


#### 逻辑地址/虚拟地址

CPU生成的地址/编译、汇编过程中所生成的地址


### MMU内存管理单元

<!--Note-->
###### 作用
- 将逻辑地址转化为物理地址

<!--/Note-->

### 内存扩充技术

#### 交换技术

同一个进程/作业


#### 覆盖技术

不同进程或作业，不会同时执行的代码共享内存空间

### 碎片

#### 内部碎片

#### 外部碎片

##### 紧缩

## 虚拟内存管理

### 按需调入/请求页

- 根据局部性原理


### 页面替换算法

- 全局替换
- 局部替换


#### FIFO算法

#### optimal algorithm（目标）

#### LRU算法

##### 实现

###### 时钟计数器

- 可借助MMU硬件实现
- 但是效率低下
	- 需要访问内存
	- 计数器位数多


###### 堆栈-双向链表实现

- 时间效率低

#### 近似LRU

##### clock 算法

#### LFU

#### MFU

### 系统抖动

#### 引入工作集

- 根据locality之和分配工作集窗口


#### PFF

- 根据缺页频率分配页帧

### 初始内存分配

#### 固定分配

- Equal Allocation
- Partition Allocation

#### 优先级分配

### page buffer algorithm

- 使用页面缓冲池，动态分配回收页面

## memory mapped I/O

- 读写内存相当于读写文件
	- 速度快
	- mmap（）函数
